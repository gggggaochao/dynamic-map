<?xml version="1.0" encoding="utf-8"?>
<s:Skin xmlns:fx="http://ns.adobe.com/mxml/2009" 
		xmlns:s="library://ns.adobe.com/flex/spark" 
		xmlns:mx="library://ns.adobe.com/flex/mx">
	<!-- host component -->
	<fx:Metadata>
		[HostComponent("com.struts.components.Clock")]
	</fx:Metadata>
	<fx:Script>
		<![CDATA[
			import flash.utils.setTimeout;
			
			import mx.core.UIComponent;
			
			import spark.components.Button;
			
			
			private var isBackComplete : Boolean = false;
			
			private var scaleWidth : Number = 1;
			
			private var scaleHeight : Number = 1;
			
			
			private var currClockFace : *;
			
			private var completeCount:int;
			
			private var iconChange : Boolean = false;
			
			/**
			 * @private
			 */
			override protected function updateDisplayList(unscaledWidth:Number, unscaledHeight:Number):void
			{

				super.updateDisplayList(unscaledWidth, unscaledHeight);
				
				if(currentState == "number")
					return;
				
				if(currClockFace != getStyle("backgroundIcon"))
				{
					currClockFace = getStyle("backgroundIcon");
					
					background.source = currClockFace;

					if(getStyle("hoursIcon"))
					{
						hoursImage.source = getStyle("hoursIcon");
					}
					
					if(getStyle("minutesIcon"))
					{
						minutesImage.source = getStyle("minutesIcon");
					}
					
					if(getStyle("secondsIcon"))
					{
						secondsImage.source = getStyle("secondsIcon");
					}
				}
			}
			
			protected override function commitProperties(): void
			{
				super.commitProperties();
				
				if(iconChange)
				{
					changeSizeClock();

					iconChange = false;
				}
			}

			private function changeSizeClock() : void
			{
				var __width : Number =  background.sourceWidth;
				var __height: Number =  background.sourceHeight;
				
				hourPointer.x = minutePointer.x = secondPointer.x = __width / 2;
				hourPointer.y = minutePointer.y = secondPointer.y = __height / 2;	
				
				changePointer(hoursImage);
				
				changePointer(minutesImage);
				
				changePointer(secondsImage);
			}
			
			private function changePointer(icon : Image) : void
			{
				var houserOffset : Number = getStyle("hoursOffset");
				var minutesOffset : Number = getStyle("minutesOffset");
				var secondsOffset : Number = getStyle("secondsOffset");

				houserOffset = isNaN(houserOffset) ? 0 : houserOffset;
				minutesOffset = isNaN(minutesOffset) ? 0 : minutesOffset;
				secondsOffset = isNaN(secondsOffset) ? 0 : secondsOffset;
				
				houserOffset = houserOffset * scaleWidth;
				minutesOffset = minutesOffset * scaleWidth;
				secondsOffset = secondsOffset * scaleWidth;
				
				if(icon == hoursImage)
				{
					hourPointer.width = icon.sourceWidth * scaleWidth;
					hourPointer.height = icon.sourceHeight * scaleHeight;
					
					hoursImage.width = hourPointer.width;
					hoursImage.height = hourPointer.height;
					hoursImage.top = -(hourPointer.height/2);
					hoursImage.left = houserOffset ? -(houserOffset) : -(hourPointer.height/2);
				}
					
				else if(icon == minutesImage)
				{
					minutePointer.width = icon.sourceWidth * scaleWidth;
					minutePointer.height = icon.sourceHeight * scaleHeight;
					
					minutesImage.width = minutePointer.width;
					minutesImage.height = minutePointer.height;
					minutesImage.top = -(minutePointer.height/2);
					minutesImage.left = minutesOffset ? -(minutesOffset) : -(minutePointer.height/2);
				}
					
				else if(icon == secondsImage)
				{
					secondPointer.width = icon.sourceWidth * scaleWidth;
					secondPointer.height = icon.sourceHeight * scaleHeight;
					
					secondsImage.width = secondPointer.width;
					secondsImage.height = secondPointer.height;
					secondsImage.top = -(secondPointer.height/2);
					secondsImage.left = secondsOffset ? -(secondsOffset) : -(secondPointer.height/2);
				}				
			}
			
			protected function completeHandler(event:Event):void
			{
				iconChange = true;
				invalidateProperties();
			}
			
		]]>
	</fx:Script>
	<!-- SkinParts
	name=background, type=spark.primitives.BitmapImage, required=false
	name=secondPointer, type=spark.primitives.BitmapImage, required=false
	name=hourPointer, type=spark.primitives.BitmapImage, required=true
	name=minutePointer, type=spark.primitives.BitmapImage, required=true
	-->

	<s:states>
		<s:State name="analog" />
		<s:State name="number" />
	</s:states>

	<s:Group top="0" left="0" right="0" bottom="0" includeIn="analog">
		<s:Image id="background"
				 smooth="true" 
				 complete="completeHandler(event)"/>		
		
		<s:Group  id="hourPointer">
			<s:Image id="hoursImage" smooth="true" complete="completeHandler(event)"/>
		</s:Group>
		
		<s:Group id="minutePointer">
			<s:Image id="minutesImage" smooth="true" complete="completeHandler(event)"/>
		</s:Group>
		
		<s:Group id="secondPointer">
			<s:Image id="secondsImage" smooth="true" complete="completeHandler(event)" />
		</s:Group>		
	</s:Group>
	
	
	<s:Label id="labelDisplay" includeIn="number" text="00:00:00" />

	
</s:Skin>
